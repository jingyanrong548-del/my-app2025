(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const L="app_links";function C(){try{const t=localStorage.getItem(L);return t?JSON.parse(t):[]}catch(t){return console.error("获取链接失败:",t),[]}}function h(t){try{return localStorage.setItem(L,JSON.stringify(t)),!0}catch(e){return console.error("保存链接失败:",e),!1}}function M(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}let d=[],b=null,w=null;function $(){d=C(),g()}function x(t){var n;const e={id:M(),title:t.title.trim(),url:t.url.trim(),description:((n=t.description)==null?void 0:n.trim())||"",createdAt:new Date().toISOString()};return d.push(e),h(d),g(),e}function H(t,e){var r;const n=d.findIndex(o=>o.id===t);return n!==-1?(d[n]={...d[n],title:e.title.trim(),url:e.url.trim(),description:((r=e.description)==null?void 0:r.trim())||""},h(d),g(),d[n]):null}function O(t){d=d.filter(e=>e.id!==t),h(d),g()}function D(t){let e=0;return t.forEach(n=>{var o;if(!d.some(i=>i.url===n.url.trim())){const i={id:M(),title:n.title.trim(),url:n.url.trim(),description:((o=n.description)==null?void 0:o.trim())||"",createdAt:new Date().toISOString()};d.push(i),e++}}),e>0&&(h(d),g()),e}function G(){return b}function S(t){b=t}function T(){return w}function F(t){w=t}function A(t){if(t){let e=t;!t.startsWith("http://")&&!t.startsWith("https://")&&(e="https://"+t),window.open(e,"_blank","noopener,noreferrer")}}function g(){const t=document.getElementById("linksGrid"),e=document.getElementById("emptyState");!t||!e||(t.innerHTML="",d.length===0?(t.style.display="none",e.style.display="block"):(t.style.display="grid",e.style.display="none",d.forEach(n=>{const r=U(n);t.appendChild(r)})))}function U(t){const e=document.createElement("div");e.className="link-card",e.setAttribute("data-id",t.id);const n=P(t.url),r=n.charAt(0).toUpperCase();return e.innerHTML=`
    <div class="card-icon">${r}</div>
    <div class="card-content">
      <h3 class="card-title">${E(t.title)}</h3>
      ${t.description?`<p class="card-description">${E(t.description)}</p>`:""}
      <p class="card-url">${E(n)}</p>
    </div>
    <div class="card-actions">
      <button class="btn-icon btn-edit" data-id="${t.id}" aria-label="编辑" title="编辑">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
      </button>
      <button class="btn-icon btn-delete" data-id="${t.id}" aria-label="删除" title="删除">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
      </button>
    </div>
  `,e.querySelector(".card-content").addEventListener("click",l=>{l.target.closest(".card-actions")||A(t.url)}),e.querySelector(".btn-edit").addEventListener("click",l=>{l.stopPropagation(),S(t.id),N(t),y("linkModal")}),e.querySelector(".btn-delete").addEventListener("click",l=>{l.stopPropagation(),F(t.id),y("deleteModal")}),e}function P(t){try{let e=t;return!t.startsWith("http://")&&!t.startsWith("https://")&&(e="https://"+t),new URL(e).hostname.replace("www.","")}catch{return t}}function E(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function N(t){document.getElementById("linkId").value=t.id,document.getElementById("linkTitle").value=t.title,document.getElementById("linkUrl").value=t.url,document.getElementById("linkDescription").value=t.description||"",document.getElementById("modalTitle").textContent="编辑链接"}function p(){document.getElementById("linkId").value="",document.getElementById("linkTitle").value="",document.getElementById("linkUrl").value="",document.getElementById("linkDescription").value="",document.getElementById("modalTitle").textContent="添加链接",S(null)}function y(t){const e=document.getElementById(t);e&&(e.style.display="flex",document.body.style.overflow="hidden")}function c(t){const e=document.getElementById(t);e&&(e.style.display="none",document.body.style.overflow="")}async function R(t){try{const e=[];let n=1,r=!0;for(;r;){const o=await fetch(`https://api.github.com/users/${t}/repos?per_page=100&page=${n}&sort=updated`);if(!o.ok)throw new Error(`GitHub API错误: ${o.status}`);const i=await o.json();i.length===0?r=!1:(e.push(...i),n++,i.length<100&&(r=!1))}return e}catch(e){throw console.error("获取GitHub仓库失败:",e),e}}function _(t,e="my-app2025"){return t.filter(n=>n.name!==e&&!n.fork).map(n=>({title:n.name,url:n.html_url,description:n.description||`GitHub仓库: ${n.name}`,homepage:n.homepage,stars:n.stargazers_count,language:n.language})).sort((n,r)=>r.stars!==n.stars?r.stars-n.stars:0)}async function q(t,e){try{const n=await R(t),r=_(n);let o=0,i=0;const s=[];for(const l of r)try{const a=l.homepage||l.url;let m=l.description;l.language&&(m+=` | 语言: ${l.language}`),l.stars>0&&(m+=` | ⭐ ${l.stars}`),e({title:l.title,url:a,description:m}),o++}catch(a){s.push({repo:l.title,error:a.message}),i++}return{success:!0,total:r.length,imported:o,skipped:i,errors:s}}catch(n){return{success:!1,error:n.message}}}document.addEventListener("DOMContentLoaded",()=>{$(),W()});function W(){const t=document.getElementById("addBtn");t&&t.addEventListener("click",()=>{p(),y("linkModal")});const e=document.getElementById("linkForm");e&&e.addEventListener("submit",j);const n=document.getElementById("closeModal");n&&n.addEventListener("click",()=>{c("linkModal"),p()});const r=document.getElementById("cancelBtn");r&&r.addEventListener("click",()=>{c("linkModal"),p()});const o=document.getElementById("confirmDeleteBtn");o&&o.addEventListener("click",J);const i=document.getElementById("cancelDeleteBtn");i&&i.addEventListener("click",()=>{c("deleteModal")});const s=document.getElementById("closeDeleteModal");s&&s.addEventListener("click",()=>{c("deleteModal")});const l=document.getElementById("linkModal");l&&l.addEventListener("click",u=>{u.target===l&&(c("linkModal"),p())});const a=document.getElementById("deleteModal");a&&a.addEventListener("click",u=>{u.target===a&&c("deleteModal")});const m=document.getElementById("importBtn");m&&m.addEventListener("click",()=>{y("importModal")});const B=document.getElementById("closeImportModal");B&&B.addEventListener("click",()=>{c("importModal"),f()});const v=document.getElementById("cancelImportBtn");v&&v.addEventListener("click",()=>{c("importModal"),f()});const k=document.getElementById("confirmImportBtn");k&&k.addEventListener("click",z);const I=document.getElementById("importModal");I&&I.addEventListener("click",u=>{u.target===I&&(c("importModal"),f())}),document.addEventListener("keydown",u=>{u.key==="Escape"&&(c("linkModal"),c("deleteModal"),c("importModal"),p(),f())})}function j(t){t.preventDefault();const e=document.getElementById("linkTitle").value.trim(),n=document.getElementById("linkUrl").value.trim(),r=document.getElementById("linkDescription").value.trim(),o=document.getElementById("linkId").value;if(!e||!n){alert("请填写标题和URL");return}const i={title:e,url:n,description:r},s=G();s&&o===s?H(s,i):x(i),c("linkModal"),p()}function J(){const t=T();t&&(O(t),c("deleteModal"))}async function z(){const t=document.getElementById("githubUsername"),e=document.getElementById("importStatus"),n=document.getElementById("importMessage"),r=document.getElementById("progressBar"),o=document.getElementById("progressFill"),i=document.getElementById("confirmImportBtn"),s=t.value.trim();if(!s){alert("请输入GitHub用户名");return}e.style.display="block",n.textContent="正在获取GitHub仓库列表...",r.style.display="block",o.style.width="0%",i.disabled=!0,i.textContent="导入中...";try{const l=await q(s,a=>{D([a])});l.success?(o.style.width="100%",n.innerHTML=`
        ✅ 导入完成！<br>
        共找到 ${l.total} 个仓库<br>
        成功导入 ${l.imported} 个链接<br>
        ${l.skipped>0?`跳过 ${l.skipped} 个（可能已存在）`:""}
      `,setTimeout(()=>{c("importModal"),f()},3e3)):(n.textContent=`❌ 导入失败: ${l.error}`,r.style.display="none")}catch(l){n.textContent=`❌ 导入失败: ${l.message}`,r.style.display="none",console.error("GitHub导入错误:",l)}finally{i.disabled=!1,i.textContent="开始导入"}}function f(){const t=document.getElementById("importStatus"),e=document.getElementById("importMessage"),n=document.getElementById("progressBar"),r=document.getElementById("progressFill"),o=document.getElementById("confirmImportBtn");t&&(t.style.display="none"),e&&(e.textContent=""),n&&(n.style.display="none"),r&&(r.style.width="0%"),o&&(o.disabled=!1,o.textContent="开始导入")}
